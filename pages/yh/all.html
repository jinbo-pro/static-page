<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport"content="width=device-width, initial-scale=1.0"><title>烟花</title><style>*{position:relative;box-sizing:border-box}html,body{height:100%}html{background-color:#000}body{margin:0;overflow:hidden;color:rgba(255,255,255,0.5);font-family:'Russo One',arial,sans-serif;line-height:1.25;letter-spacing:0.06em}.hide{opacity:0;visibility:hidden}.remove{display:none!important}.blur{filter:blur(12px)}.container{height:100%;display:flex;justify-content:center;align-items:center}.loading-init{width:100%;align-self:center;text-align:center;text-transform:uppercase}.loading-init__header{font-size:2.2em}.loading-init__status{margin-top:1em;font-size:0.8em;opacity:0.75}.stage-container{overflow:hidden;box-sizing:initial;margin:-1px}@media(max-width:840px){.stage-container{border:none;margin:0}}.canvas-container{width:100%;height:100%;transition:filter 0.3s}.canvas-container canvas{position:absolute;mix-blend-mode:lighten;transform:translateZ(0)}.controls{position:absolute;top:0;width:100%;padding-bottom:50px;display:flex;justify-content:space-between;transition:opacity 0.3s,visibility 0.3s}@media(min-width:840px){.controls{visibility:visible}.controls.hide:hover{opacity:1}}.menu{position:absolute;top:0;bottom:0;left:0;right:0;background-color:rgba(0,0,0,0.42);transition:opacity 0.3s,visibility 0.3s}.menu__inner-wrap{display:flex;flex-direction:column;justify-content:center;align-items:center;position:absolute;top:0;bottom:0;left:0;right:0;transition:opacity 0.3s}.menu__header{margin-bottom:8px;padding-top:16px;font-size:2em;text-transform:uppercase}.menu form{width:100%;max-width:400px;padding:0 10px;overflow:auto;-webkit-overflow-scrolling:touch}.menu.form-option{display:flex;align-items:center;margin:16px 0;transition:opacity 0.3s}.menu.form-option label{display:block;width:38%;padding-right:12px;text-align:right;text-transform:uppercase;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.menu.form-option--select select{display:block;width:60%;height:30px;font-size:1rem;font-family:'Russo One',arial,sans-serif;color:rgba(255,255,255,0.5);letter-spacing:0.06em;background-color:transparent;border:1px solid rgba(255,255,255,0.5)}.menu.form-option--select select option{background-color:black}.menu.form-option--checkbox input{display:block;width:26px;height:26px;margin:0;opacity:0.5}@media(max-width:840px){.menu.form-option select,.menu.form-option input{outline:none}}.close-menu-btn{position:absolute;top:0;right:0}.btn{opacity:0.16;width:50px;height:50px;display:flex;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default;transition:opacity 0.3s}.btn--bright{opacity:0.5}@media(min-width:840px){.btn:hover{opacity:0.32}.btn--bright:hover{opacity:0.75}}.btn svg{display:block;margin:auto}.help-modal{display:flex;justify-content:center;align-items:center;position:fixed;top:0;bottom:0;left:0;right:0;visibility:hidden;transition-property:visibility;transition-duration:0.25s}.help-modal__overlay{position:absolute;top:0;bottom:0;left:0;right:0;opacity:0;transition-property:opacity;transition-timing-function:ease-in;transition-duration:0.25s}.help-modal__dialog{display:flex;flex-direction:column;align-items:center;max-width:400px;max-height:calc(100vh-100px);margin:10px;padding:20px;border-radius:0.3em;background-color:rgba(0,0,0,0.4);opacity:0;transform:scale(0.9,0.9);transition-property:opacity,transform;transition-timing-function:ease-in;transition-duration:0.25s}@media(min-width:840px){.help-modal__dialog{font-size:1.25rem;max-width:500px}}.help-modal__header{font-size:1.75em;text-transform:uppercase;text-align:center}.help-modal__body{overflow-y:auto;-webkit-overflow-scrolling:touch;margin:1em 0;padding:1em 0;border-top:1px solid rgba(255,255,255,0.25);border-bottom:1px solid rgba(255,255,255,0.25);line-height:1.5;color:rgba(255,255,255,0.75)}.help-modal__close-btn{flex-shrink:0;outline:none;border:none;border-radius:2px;padding:0.25em 0.75em;margin-top:0.36em;font-family:'Russo One',arial,sans-serif;font-size:1em;color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:0.06em;background-color:rgba(255,255,255,0.25);transition:color 0.3s,background-color 0.3s}.help-modal__close-btn:hover,.help-modal__close-btn:active,.help-modal__close-btn:focus{color:#fff;background-color:#09f}.help-modal.active{visibility:visible;transition-duration:0.4s}.help-modal.active.help-modal__overlay{opacity:1;transition-timing-function:ease-out;transition-duration:0.4s}.help-modal.active.help-modal__dialog{opacity:1;transform:scale(1,1);transition-timing-function:ease-out;transition-duration:0.4s}</style></head><body><!--partial:index.partial.html--><!--SVG Spritesheet--><div style="height: 0; width: 0; position: absolute; visibility: hidden"><svg xmlns="http://www.w3.org/2000/svg"><symbol id="icon-play"viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></symbol><symbol id="icon-pause"viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></symbol><symbol id="icon-close"viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></symbol><symbol id="icon-settings"viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></symbol><symbol id="icon-sound-on"viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></symbol><symbol id="icon-sound-off"viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></symbol></svg></div><!--App--><div class="container"><div class="loading-init"><div class="loading-init__header">Loading</div><div class="loading-init__status">Assembling Shells</div></div><div class="stage-container remove"><div class="canvas-container"><canvas id="trails-canvas"></canvas><canvas id="main-canvas"></canvas></div><div class="controls"><div class="btn pause-btn"><svg fill="white"width="24"height="24"><use href="#icon-pause"xlink:href="#icon-pause"></use></svg></div><div class="btn sound-btn"><svg fill="white"width="24"height="24"><use href="#icon-sound-off"xlink:href="#icon-sound-off"></use></svg></div><div class="btn settings-btn"><svg fill="white"width="24"height="24"><use href="#icon-settings"xlink:href="#icon-settings"></use></svg></div></div><div class="menu hide"><div class="menu__inner-wrap"><div class="btn btn--bright close-menu-btn"><svg fill="white"width="24"height="24"><use href="#icon-close"xlink:href="#icon-close"></use></svg></div><div class="menu__header">设置</div><form><div class="form-option form-option--select"><label class="shell-type-label">烟花类型</label><select class="shell-type"></select></div><div class="form-option form-option--select"><label class="shell-size-label">烟花大小</label><select class="shell-size"></select></div><div class="form-option form-option--select"><label class="quality-ui-label">画质</label><select class="quality-ui"></select></div><div class="form-option form-option--select"><label class="sky-lighting-label">照亮背景</label><select class="sky-lighting"></select></div><div class="form-option form-option--select"><label class="scaleFactor-label">大小</label><select class="scaleFactor"></select></div><div class="form-option form-option--checkbox"><label class="auto-launch-label">自动发射</label><input class="auto-launch"type="checkbox"/></div><div class="form-option form-option--checkbox form-option--finale-mode"><label class="finale-mode-label">狂热模式</label><input class="finale-mode"type="checkbox"/></div><div class="form-option form-option--checkbox"><label class="hide-controls-label">隐藏控件</label><input class="hide-controls"type="checkbox"/></div><div class="form-option form-option--checkbox form-option--fullscreen"><label class="fullscreen-label">全屏</label><input class="fullscreen"type="checkbox"/></div><div class="form-option form-option--checkbox"><label class="long-exposure-label">打开快门</label><input class="long-exposure"type="checkbox"/></div></form></div></div></div><div class="help-modal"><div class="help-modal__overlay"></div><div class="help-modal__dialog"><div class="help-modal__header"></div><div class="help-modal__body"></div><button type="button"class="help-modal__close-btn">关闭</button></div></div></div>
  <script>
    (()=>{var x={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5},Ie=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror"],Re=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror"],ze=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError"],w=typeof window<"u"&&typeof window.document<"u"?window.document:{},F="fullscreenEnabled"in w&&Object.keys(x)||Ie[0]in w&&Ie||Re[0]in w&&Re||ze[0]in w&&ze||[],B={requestFullscreen:function(t){return t[F[x.requestFullscreen]]()},requestFullscreenFunction:function(t){return t[F[x.requestFullscreen]]},get exitFullscreen(){return w[F[x.exitFullscreen]].bind(w)},addEventListener:function(t,n,o){return w.addEventListener(F[x[t]],n,o)},removeEventListener:function(t,n){return w.removeEventListener(F[x[t]],n)},get fullscreenEnabled(){return!!w[F[x.fullscreenEnabled]]},set fullscreenEnabled(e){},get fullscreenElement(){return w[F[x.fullscreenElement]]},set fullscreenElement(e){},get onfullscreenchange(){return w[("on"+F[x.fullscreenchange]).toLowerCase()]},set onfullscreenchange(e){return w[("on"+F[x.fullscreenchange]).toLowerCase()]=e},get onfullscreenerror(){return w[("on"+F[x.fullscreenerror]).toLowerCase()]},set onfullscreenerror(e){return w[("on"+F[x.fullscreenerror]).toLowerCase()]=e}};var g={};g.toDeg=180/Math.PI;g.toRad=Math.PI/180;g.halfPI=Math.PI/2;g.twoPI=Math.PI*2;g.dist=(e,t)=>Math.sqrt(e*e+t*t);g.pointDist=(e,t,n,o)=>{let s=n-e,i=o-t;return Math.sqrt(s*s+i*i)};g.angle=(e,t)=>g.halfPI+Math.atan2(t,e);g.pointAngle=(e,t,n,o)=>g.halfPI+Math.atan2(o-t,n-e);g.splitVector=(e,t)=>({x:Math.sin(t)*e,y:-Math.cos(t)*e});g.random=(e,t)=>Math.random()*(t-e)+e;g.randomInt=(e,t)=>(Math.random()*(t-e+1)|0)+e;g.randomChoice=function(t){return arguments.length===1&&Array.isArray(t)?t[Math.random()*t.length|0]:arguments[Math.random()*arguments.length|0]};g.clamp=function(t,n,o){return Math.min(Math.max(t,n),o)};function De(e){if(typeof e!="function")throw"Ticker.addListener() requires a function reference passed for a callback.";He.push(e),qe||(qe=!0,Oe())}var qe=!1,Pe=0,He=[];function Oe(){window.requestAnimationFrame?requestAnimationFrame(_e):webkitRequestAnimationFrame(_e)}function _e(e){let t=e-Pe;Pe=e,t<0?t=17:t>68&&(t=68),He.forEach(n=>n.call(window,t,t/16.6667)),Oe()}var Ae=0,T=class e{constructor(t){typeof t=="string"&&(t=document.getElementById(t)),this.canvas=t,this.ctx=t.getContext("2d"),this.canvas.style.touchAction="none",this.speed=1,this.dpr=e.disableHighDPI?1:(window.devicePixelRatio||1)/(this.ctx.backingStorePixelRatio||1),this.width=t.width,this.height=t.height,this.naturalWidth=this.width*this.dpr,this.naturalHeight=this.height*this.dpr,this.width!==this.naturalWidth&&(this.canvas.width=this.naturalWidth,this.canvas.height=this.naturalHeight,this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px"),e.stages.push(this),this._listeners={resize:[],pointerstart:[],pointermove:[],pointerend:[],lastPointerPos:{x:0,y:0}}}static stages=[];static disableHighDPI=!1;static windowToCanvas(t,n,o){let s=t.getBoundingClientRect();return{x:(n-s.left)*(t.width/s.width),y:(o-s.top)*(t.height/s.height)}}static mouseHandler(t){if(Date.now()-Ae<500)return;let n="start";t.type==="mousemove"?n="move":t.type==="mouseup"&&(n="end"),e.stages.forEach(o=>{let s=e.windowToCanvas(o.canvas,t.clientX,t.clientY);o.pointerEvent(n,s.x/o.dpr,s.y/o.dpr)})}static touchHandler(t){Ae=Date.now();let n="start";t.type==="touchmove"?n="move":t.type==="touchend"&&(n="end"),e.stages.forEach(o=>{for(let s of Array.from(t.changedTouches)){let i;n!=="end"?(i=e.windowToCanvas(o.canvas,s.clientX,s.clientY),o._listeners.lastPointerPos=i,n==="start"&&o.pointerEvent("move",i.x/o.dpr,i.y/o.dpr)):i=o._listeners.lastPointerPos,o.pointerEvent(n,i.x/o.dpr,i.y/o.dpr)}})}addEventListener(t,n){try{t==="ticker"?De(n):this._listeners[t].push(n)}catch{throw"Invalid Event"}}dispatchEvent(t,n){let o=this._listeners[t];if(o)o.forEach(s=>s.call(this,n));else throw"Invalid Event"}resize(t,n){this.width=t,this.height=n,this.naturalWidth=t*this.dpr,this.naturalHeight=n*this.dpr,this.canvas.width=this.naturalWidth,this.canvas.height=this.naturalHeight,this.canvas.style.width=t+"px",this.canvas.style.height=n+"px",this.dispatchEvent("resize")}pointerEvent(t,n,o){let s={type:t,x:n,y:o};s.onCanvas=n>=0&&n<=this.width&&o>=0&&o<=this.height,this.dispatchEvent("pointer"+t,s)}};document.addEventListener("mousedown",T.mouseHandler);document.addEventListener("mousemove",T.mouseHandler);document.addEventListener("mouseup",T.mouseHandler);document.addEventListener("touchstart",T.touchHandler);document.addEventListener("touchmove",T.touchHandler);document.addEventListener("touchend",T.touchHandler);var rt=window.innerWidth<=640,U=window.innerWidth>800,_=U&&window.innerHeight<300,lt=(()=>{let e=navigator.hardwareConcurrency;if(!e)return!1;let t=window.innerWidth<=1024?4:8;return e>=t})(),ct=7680,ht=4320,ut=.9,K=1;function dt(){return rt?.9:_?.75:1}var ae,ie,I=1,re=!1,ft=!0,Q=!1,Ye=1,be=2,ne=3,Le=0,pt=1,Ne=2,p={Red:"#ff0043",Green:"#14fc56",Blue:"#1e7fff",Purple:"#e60aff",Gold:"#ffbf36",White:"#ffffff"},D="_INVISIBLE_",q=Math.PI*2,Me=Math.PI*.5,Xe=new T("trails-canvas"),C=new T("main-canvas"),mt=[Xe,C];function $e(){return B.fullscreenEnabled}function ve(){return!!B.fullscreenElement}function gt(){$e()&&(ve()?B.exitFullscreen():B.requestFullscreen(document.documentElement))}B.addEventListener("fullscreenchange",()=>{f.setState({fullscreen:ve()})});var f={_listeners:new Set,_dispatch(e){this._listeners.forEach(t=>t(this.state,e))},state:{paused:!0,soundEnabled:!1,menuOpen:!1,openHelpTopic:null,fullscreen:ve(),config:{quality:String(lt?ne:be),shell:"Random",size:U?"3":_?"1.2":"2",autoLaunch:!0,finale:!1,skyLighting:Ne+"",hideControls:_,longExposure:!1,scaleFactor:dt()}},setState(e){let t=this.state;this.state=Object.assign({},this.state,e),this._dispatch(t),this.persist()},subscribe(e){return this._listeners.add(e),()=>this._listeners.remove(e)},load(){let e=localStorage.getItem("cm_fireworks_data");if(e){let{schemaVersion:t,data:n}=JSON.parse(e),o=this.state.config;switch(t){case"1.1":o.quality=n.quality,o.size=n.size,o.skyLighting=n.skyLighting;break;case"1.2":o.quality=n.quality,o.size=n.size,o.skyLighting=n.skyLighting,o.scaleFactor=n.scaleFactor;break;default:throw new Error("version switch should be exhaustive")}console.log(`Loaded config (schema version ${t})`)}else if(localStorage.getItem("schemaVersion")==="1"){let t;try{let o=localStorage.getItem("configSize");t=typeof o=="string"&&JSON.parse(o)}catch(o){console.log("Recovered from error parsing saved config:"),console.error(o);return}let n=parseInt(t,10);n>=0&&n<=4&&(this.state.config.size=String(n))}},persist(){let e=this.state.config;localStorage.setItem("cm_fireworks_data",JSON.stringify({schemaVersion:"1.2",data:{quality:e.quality,size:e.size,skyLighting:e.skyLighting,scaleFactor:e.scaleFactor}}))}};_||f.load();function we(e){let t=f.state.paused,n;typeof e=="boolean"?n=e:n=!t,t!==n&&f.setState({paused:n})}function yt(e){typeof e=="boolean"?f.setState({soundEnabled:e}):f.setState({soundEnabled:!f.state.soundEnabled})}function pe(e){typeof e=="boolean"?f.setState({menuOpen:e}):f.setState({menuOpen:!f.state.menuOpen})}function X(e){e=e||vt(),f.setState({config:Object.assign({},f.state.config,e)}),je()}function je(){let e=f.state.config;I=St(),re=I===Ye,ft=I===be,Q=I===ne,ke()===Le&&(h.canvasContainer.style.backgroundColor="#000"),P.drawWidth=I===ne?.75:1}var le=(e=f.state)=>!e.paused&&!e.menuOpen,Ue=(e=f.state)=>e.soundEnabled,me=(e=f.state)=>le(e)&&Ue(e),St=()=>+f.state.config.quality,A=()=>f.state.config.shell,V=()=>+f.state.config.size,bt=()=>f.state.config.finale,ke=()=>+f.state.config.skyLighting,Ke=()=>f.state.config.scaleFactor,Lt={shellType:{header:"烟花类型",body:"将发射的烟花类型。选择“随机”以获得不错的分类！"},shellSize:{header:"烟花大小",body:"烟花的大小。以真实的烟花外壳大小为模型，更大的外壳会产生更大的爆发，伴随着更多的恒星，有时还会产生更复杂的效果。然而，更大的外壳也需要更多的处理能力，并可能导致滞后。"},quality:{header:"画质",body:"整体画质。如果动画运行不顺利，请尝试降低质量。高质量会大大增加渲染的火花量，并可能导致延迟。"},skyLighting:{header:"照亮背景",body:"当焰火爆炸时照亮背景。如果背景在屏幕上看起来太亮，请尝试将其设置为“暗淡”或“无”。"},scaleFactor:{header:"大小",body:"允许缩放所有烟花的大小，实质上是将您移动得更近或更远。对于较大的外壳尺寸，可以方便地将尺寸缩小一点，尤其是在手机或平板电脑上。"},autoLaunch:{header:"自动发射",body:"自动发射焰火序列。坐下来欣赏表演，或者禁用以完全控制。"},finaleMode:{header:"狂热模式",body:"发射强烈的烟花。可能导致滞后。需要启用“自动发射”。"},hideControls:{header:"隐藏控件",body:"隐藏屏幕顶部的半透明控件。对于屏幕截图很有用，或者只是一种更无缝的体验。隐藏时，您仍然可以点击右上角重新打开此菜单。"},fullscreen:{header:"全屏",body:"切换全屏模式"},longExposure:{header:"打开快门",body:"保留长条纹光的实验效果，类似于打开相机快门"}},We={shellTypeLabel:"shellType",shellSizeLabel:"shellSize",qualityLabel:"quality",skyLightingLabel:"skyLighting",scaleFactorLabel:"scaleFactor",autoLaunchLabel:"autoLaunch",finaleModeLabel:"finaleMode",hideControlsLabel:"hideControls",fullscreenLabel:"fullscreen",longExposureLabel:"longExposure"},h={stageContainer:".stage-container",canvasContainer:".canvas-container",controls:".controls",menu:".menu",menuInnerWrap:".menu__inner-wrap",pauseBtn:".pause-btn",pauseBtnSVG:".pause-btn use",soundBtn:".sound-btn",soundBtnSVG:".sound-btn use",shellType:".shell-type",shellTypeLabel:".shell-type-label",shellSize:".shell-size",shellSizeLabel:".shell-size-label",quality:".quality-ui",qualityLabel:".quality-ui-label",skyLighting:".sky-lighting",skyLightingLabel:".sky-lighting-label",scaleFactor:".scaleFactor",scaleFactorLabel:".scaleFactor-label",autoLaunch:".auto-launch",autoLaunchLabel:".auto-launch-label",finaleModeFormOption:".form-option--finale-mode",finaleMode:".finale-mode",finaleModeLabel:".finale-mode-label",hideControls:".hide-controls",hideControlsLabel:".hide-controls-label",fullscreenFormOption:".form-option--fullscreen",fullscreen:".fullscreen",fullscreenLabel:".fullscreen-label",longExposure:".long-exposure",longExposureLabel:".long-exposure-label",helpModal:".help-modal",helpModalOverlay:".help-modal__overlay",helpModalHeader:".help-modal__header",helpModalBody:".help-modal__body",helpModalCloseBtn:".help-modal__close-btn"};Object.keys(h).forEach(e=>{h[e]=document.querySelector(h[e])});$e()||h.fullscreenFormOption.classList.add("remove");function Qe(e){let t=`#icon-${e.paused?"play":"pause"}`,n=`#icon-sound-${Ue()?"on":"off"}`;if(h.pauseBtnSVG.setAttribute("href",t),h.pauseBtnSVG.setAttribute("xlink:href",t),h.soundBtnSVG.setAttribute("href",n),h.soundBtnSVG.setAttribute("xlink:href",n),h.controls.classList.toggle("hide",e.menuOpen||e.config.hideControls),h.canvasContainer.classList.toggle("blur",e.menuOpen),h.menu.classList.toggle("hide",!e.menuOpen),h.finaleModeFormOption.style.opacity=e.config.autoLaunch?1:.32,h.quality.value=e.config.quality,h.shellType.value=e.config.shell,h.shellSize.value=e.config.size,h.autoLaunch.checked=e.config.autoLaunch,h.finaleMode.checked=e.config.finale,h.skyLighting.value=e.config.skyLighting,h.hideControls.checked=e.config.hideControls,h.fullscreen.checked=e.fullscreen,h.longExposure.checked=e.config.longExposure,h.scaleFactor.value=e.config.scaleFactor.toFixed(2),h.menuInnerWrap.style.opacity=e.openHelpTopic?.12:1,h.helpModal.classList.toggle("active",!!e.openHelpTopic),e.openHelpTopic){let{header:o,body:s}=Lt[e.openHelpTopic];h.helpModalHeader.textContent=o,h.helpModalBody.textContent=s}}f.subscribe(Qe);function Mt(e,t){let n=me(e),o=me(t);n!==o&&(n?z.resumeAll():z.pauseAll())}f.subscribe(Mt);function vt(){return{quality:h.quality.value,shell:h.shellType.value,size:h.shellSize.value,autoLaunch:h.autoLaunch.checked,finale:h.finaleMode.checked,skyLighting:h.skyLighting.value,longExposure:h.longExposure.checked,hideControls:h.hideControls.checked,scaleFactor:parseFloat(h.scaleFactor.value)}}var ce=()=>X();h.quality.addEventListener("input",ce);h.shellType.addEventListener("input",ce);h.shellSize.addEventListener("input",ce);h.autoLaunch.addEventListener("click",()=>setTimeout(X,0));h.finaleMode.addEventListener("click",()=>setTimeout(X,0));h.skyLighting.addEventListener("input",ce);h.longExposure.addEventListener("click",()=>setTimeout(X,0));h.hideControls.addEventListener("click",()=>setTimeout(X,0));h.fullscreen.addEventListener("click",()=>setTimeout(gt,0));h.scaleFactor.addEventListener("input",()=>{X(),Fe()});Object.keys(We).forEach(e=>{let t=We[e];h[e].addEventListener("click",()=>{f.setState({openHelpTopic:t})})});h.helpModalCloseBtn.addEventListener("click",()=>{f.setState({openHelpTopic:null})});h.helpModalOverlay.addEventListener("click",()=>{f.setState({openHelpTopic:null})});var wt=Object.keys(p),W=wt.map(e=>p[e]),Ce=[...W,D],dn=Ce.reduce((e,t,n)=>(e[t]=n,e),{}),Je={};W.forEach(e=>{Je[e]={r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}});function te(){return W[Math.random()*W.length|0]}var Ve;function M(e){let t=e&&e.notSame,n=e&&e.notColor,o=e&&e.limitWhite,s=te();if(o&&s===p.White&&Math.random()<.6&&(s=te()),t)for(;s===Ve;)s=te();else if(n)for(;s===n;)s=te();return Ve=s,s}function Ee(){return Math.random()<.5?p.Gold:p.White}function $(e){return e===p.White||e===p.Gold?M({notColor:e}):Ee()}var J=(e=1)=>{let t=Math.random()<.25,n=Math.random()<.72,o=n?M({limitWhite:!0}):[M(),M({notSame:!0})],s=n&&Math.random()<.42,i=s&&$(o),c=n&&(Math.random()<.2||o===p.White)?i||M({notColor:o,limitWhite:!0}):null,l=!s&&o!==p.White&&Math.random()<.42,r=t?1.1:1.25;return re&&(r*=.8),Q&&(r=1.2),{shellSize:e,spreadSize:300+e*100,starLife:900+e*200,starDensity:r,color:o,secondColor:c,glitter:t?"light":"",glitterColor:Ee(),pistil:s,pistilColor:i,streamers:l}},kt=(e=1)=>{let t=J(e);t.starLife*=1.5;let n=M({notColor:p.White});t.streamers=!0;let s=Math.random()<.42&&$(n);return t.color=D,t.secondColor=n,t.glitter="",t},Ct=(e=1)=>{let t=M({limitWhite:!0});return{shellSize:e,spreadSize:280+e*92,starLife:1100+e*200,starLifeVariation:.4,starDensity:1.1,color:t,glitter:"light",glitterColor:p.White,strobe:!0,strobeColor:Math.random()<.5?p.White:null,pistil:Math.random()<.5,pistilColor:$(t)}},Et=(e=1)=>{let t=M(),n=Math.random()<.5;return{shellSize:e,color:t,spreadSize:250+e*75,starDensity:n?.15:.4,starLife:1800+e*200,glitter:n?"thick":"heavy"}},xe=(e=1)=>{let t=M(),n=Math.random()<.75;return{shellSize:e,ring:!0,color:t,spreadSize:300+e*100,starLife:900+e*200,starCount:2.2*q*(e+1),pistil:n,pistilColor:$(t),glitter:n?"":"light",glitterColor:t===p.Gold?p.Gold:p.White,streamers:Math.random()<.3}},xt=(e=1)=>{let t=M({limitWhite:!0});return{shellSize:e,spreadSize:300+e*100,starLife:750+e*160,starLifeVariation:.4,starDensity:.85,color:t,crossette:!0,pistil:Math.random()<.5,pistilColor:$(t)}},Ft=(e=1)=>({shellSize:e,spreadSize:300+e*120,starDensity:.12,starLife:500+e*50,starLifeVariation:.5,color:Math.random()<.65?"random":Math.random()<.15?M():[M(),M({notSame:!0})],floral:!0}),Tt=(e=1)=>({shellSize:e,color:D,spreadSize:300+e*120,starDensity:.12,starLife:500+e*50,starLifeVariation:.5,glitter:"medium",glitterColor:p.Gold,fallingLeaves:!0}),It=(e=1)=>({shellSize:e,spreadSize:300+e*100,starDensity:.6,starLife:3e3+e*300,glitter:"willow",glitterColor:p.Gold,color:D}),Rt=(e=1)=>{let t=Math.random()<.75?p.Gold:M();return{shellSize:e,spreadSize:380+e*75,starDensity:re?.65:1,starLife:600+e*100,starLifeVariation:.32,glitter:"light",glitterColor:p.Gold,color:t,crackle:!0,pistil:Math.random()<.65,pistilColor:$(t)}},zt=(e=1)=>{let t=M();return{shellSize:e,horsetail:!0,color:t,spreadSize:250+e*38,starDensity:.9,starLife:2500+e*300,glitter:"medium",glitterColor:Math.random()<.5?Ee():t,strobe:t===p.White}};function ge(){return Math.random()<.5?"Crysanthemum":ye[Math.random()*(ye.length-1)+1|0]}function Ze(e){return _?he()(e):j[ge()](e)}function oe(e){return j[A()](e)}var qt=["Falling Leaves","Floral","Willow"];function he(){let e=A()==="Random",t=e?ge():A();if(e)for(;qt.includes(t);)t=ge();return j[t]}var j={Random:Ze,Crackle:Rt,Crossette:xt,Crysanthemum:J,"Falling Leaves":Tt,Floral:Ft,Ghost:kt,"Horse Tail":zt,Palm:Et,Ring:xe,Strobe:Ct,Willow:It},Pt={Random:"随机",Crackle:"爆裂",Crossette:"交叉",Crysanthemum:"菊花","Falling Leaves":"落叶",Floral:"花",Ghost:"幽灵","Horse Tail":"马尾",Palm:"棕榈",Ring:"环",Strobe:"闪烁",Willow:"柳树"},ye=Object.keys(j);function ue(){document.querySelector(".loading-init").remove(),h.stageContainer.classList.remove("remove");function e(n,o){n.innerHTML=o.reduce((s,i)=>s+=`<option value="${i.value}">${i.label}</option>`,"")}let t="";ye.forEach(n=>t+=`<option value="${n}">${Pt[n]}</option>`),h.shellType.innerHTML=t,t="",['3"','4"','6"','8"','12"','16"'].forEach((n,o)=>t+=`<option value="${o}">${n}</option>`),h.shellSize.innerHTML=t,e(h.quality,[{label:"低",value:Ye},{label:"中",value:be},{label:"高",value:ne}]),e(h.skyLighting,[{label:"无",value:Le},{label:"暗淡",value:pt},{label:"正常",value:Ne}]),e(h.scaleFactor,[.5,.62,.75,.9,1,1.5,2].map(n=>({value:n.toFixed(2),label:`${n*100}%`}))),we(!1),Qe(f.state),je()}function et(e){return(1-.18*2)*e+.18}function tt(e){return e*.75}function _t(){return et(Math.random())}function Dt(){return tt(Math.random())}function se(){let e=V(),t=Math.min(2.5,e),n=Math.random()*t,o=e-n,s=t===0?Math.random():1-n/t,i=Math.random()*(1-s*.65)*.5,c=Math.random()<.5?.5-i:.5+i;return{size:o,x:et(c),height:tt(s)}}function Ht(e){let t=new E(oe(V())),n=C.width,o=C.height;t.launch(e?e.x/n:_t(),e?1-e.y/o:Dt())}function Ot(){let e=se(),t=new E(oe(e.size));t.launch(e.x,e.height);let n=t.starLife;return t.fallingLeaves&&(n=4600),900+Math.random()*600+n}function At(){let e=he(),t=se(),n=new E(e(t.size));n.launch(t.x,t.height);let o=n.starLife;return 900+Math.random()*600+o}function Be(){let e=se(),t=se(),n=new E(oe(e.size)),o=new E(oe(t.size)),s=Math.random()*.2-.1,i=Math.random()*.2-.1;n.launch(.3+s,e.height),setTimeout(()=>{o.launch(.7+i,t.height)},100);let c=Math.max(n.starLife,o.starLife);return(n.fallingLeaves||o.fallingLeaves)&&(c=4600),900+Math.random()*600+c}function Wt(){let e=he(),t=V(),n=Math.max(0,t-1.25),o=Math.random()*.08-.04;new E(e(t)).launch(.5+o,.7);let i=1e3+Math.random()*400,c=1e3+Math.random()*400;return setTimeout(()=>{let l=Math.random()*.08-.04;new E(e(n)).launch(.2+l,.1)},i),setTimeout(()=>{let l=Math.random()*.08-.04;new E(e(n)).launch(.8+l,.1)},c),4e3}function Vt(){let e=U?7:4,t=V(),n=Math.max(0,t-3),o=Math.random()<.78?J:xe,s=Ze;function i(r,u){let v=A()==="Random"?u?s:o:j[A()],S=new E(v(u?t:n)),d=r<=.5?r/.5:(1-r)/.5;S.launch(r,u?.75:d*.42)}let c=0,l=0;for(;c<=e;){if(c===e)setTimeout(()=>{i(.5,!0)},l);else{let r=c/e*.5,u=Math.random()*30+30;setTimeout(()=>{i(r,!1)},l),setTimeout(()=>{i(1-r,!1)},l+u)}c++,l+=200}return 3400+e*250}function G(){G.lastCalled=Date.now();let e=U?11:5,t=U?3:1,n=Math.max(0,V()-2),o=Math.random()<.78?J:xe,s=he();function i(r,u){let v=A()==="Random"?u?s:o:j[A()],S=new E(v(n)),d=(Math.cos(r*5*Math.PI+Me)+1)/2;S.launch(r,d*.75)}let c=0,l=0;for(;c<e;){if(c===0)i(.5,!1),c+=1;else{let r=(c+1)/e/2,u=Math.random()*30+30,m=c===t;setTimeout(()=>{i(.5+r,m)},l),setTimeout(()=>{i(.5-r,m)},l+u),c+=2}l+=200}return 3400+e*120}G.cooldown=15e3;G.lastCalled=Date.now();var Ge=!0,Bt=32,de=0;function Gt(){if(Ge)return Ge=!1,_?Be():(new E(J(V())).launch(.5,.5),2400);if(bt())return At(),de<Bt?(de++,170):(de=0,6e3);let e=Math.random();if(e<.08&&Date.now()-G.lastCalled>G.cooldown)return G();if(e<.1)return Vt();if(e<.6&&!_)return Ot();if(e<.8)return Be();if(e<1)return Wt()}var nt=0,Z=!1;function Yt(e){nt++;let t=50;if(e.y<t){if(e.x<t){we();return}if(e.x>C.width/2-t/2&&e.x<C.width/2+t/2){yt();return}if(e.x>C.width-t){pe();return}}le()&&(ot(e)?Z=!0:e.onCanvas&&Ht(e))}function Nt(e){nt--,Z=!1}function Xt(e){le()&&Z&&ot(e)}function $t(e){e.keyCode===80?we():e.keyCode===79?pe():e.keyCode===27&&pe(!1)}C.addEventListener("pointerstart",Yt);C.addEventListener("pointerend",Nt);C.addEventListener("pointermove",Xt);window.addEventListener("keydown",$t);function Fe(){let e=window.innerWidth,t=window.innerHeight,n=Math.min(e,ct),o=e<=420?t:Math.min(t,ht);h.stageContainer.style.width=n+"px",h.stageContainer.style.height=o+"px",mt.forEach(i=>i.resize(n,o));let s=Ke();ae=n/s,ie=o/s}Fe();window.addEventListener("resize",Fe);var Se=0,Y=0,fe=0;function ot(e){if(Z||e.y>=C.height-44){let n=(e.x-16)/(C.width-32);return K=Math.min(Math.max(n,0),1),Y=1,!0}return!1}function jt(e,t){Se++,Z||(Y-=t/30,Y<0&&(Y=0)),f.state.config.autoLaunch&&(fe-=e,fe<=0&&(fe=Gt()*1.25))}function Ut(e,t){if(!le())return;let n=ae,o=ie,s=e*K,i=K*t;jt(s,t);let c=1-(1-k.airDrag)*i,l=1-(1-k.airDragHeavy)*i,r=1-(1-P.airDrag)*i,u=s/1e3*ut;Ce.forEach(m=>{let v=k.active[m];for(let d=v.length-1;d>=0;d=d-1){let a=v[d];if(a.updateFrame!==Se)if(a.updateFrame=Se,a.life-=s,a.life<=0)v.splice(d,1),k.returnInstance(a);else{let b=Math.pow(a.life/a.fullLife,.5),y=1-b;if(a.prevX=a.x,a.prevY=a.y,a.x+=a.speedX*i,a.y+=a.speedY*i,a.heavy?(a.speedX*=l,a.speedY*=l):(a.speedX*=c,a.speedY*=c),a.speedY+=u,a.spinRadius&&(a.spinAngle+=a.spinSpeed*i,a.x+=Math.sin(a.spinAngle)*a.spinRadius*i,a.y+=Math.cos(a.spinAngle)*a.spinRadius*i),a.sparkFreq)for(a.sparkTimer-=s;a.sparkTimer<0;)a.sparkTimer+=a.sparkFreq*.75+a.sparkFreq*y*4,P.add(a.x,a.y,a.sparkColor,Math.random()*q,Math.random()*a.sparkSpeed*b,a.sparkLife*.8+Math.random()*a.sparkLifeVariation*a.sparkLife);a.life<a.transitionTime&&(a.secondColor&&!a.colorChanged&&(a.colorChanged=!0,a.color=a.secondColor,v.splice(d,1),k.active[a.secondColor].push(a),a.secondColor===D&&(a.sparkFreq=0)),a.strobe&&(a.visible=Math.floor(a.life/a.strobeFreq)%3===0))}}let S=P.active[m];for(let d=S.length-1;d>=0;d=d-1){let a=S[d];a.life-=s,a.life<=0?(S.splice(d,1),P.returnInstance(a)):(a.prevX=a.x,a.prevY=a.y,a.x+=a.speedX*i,a.y+=a.speedY*i,a.speedX*=r,a.speedY*=r,a.speedY+=u)}}),Kt(i)}function Kt(e){let{dpr:t}=C,n=ae,o=ie,s=Xe.ctx,i=C.ctx;ke()!==Le&&Qt(e);let c=Ke();for(s.scale(t*c,t*c),i.scale(t*c,t*c),s.globalCompositeOperation="source-over",s.fillStyle=`rgba(0, 0, 0, ${f.state.config.longExposure?.0025:.175*e})`,s.fillRect(0,0,n,o),i.clearRect(0,0,n,o);N.active.length;){let l=N.active.pop(),r=s.createRadialGradient(l.x,l.y,0,l.x,l.y,l.radius);r.addColorStop(.024,"rgba(255, 255, 255, 1)"),r.addColorStop(.125,"rgba(255, 160, 20, 0.2)"),r.addColorStop(.32,"rgba(255, 140, 20, 0.11)"),r.addColorStop(1,"rgba(255, 120, 20, 0)"),s.fillStyle=r,s.fillRect(l.x-l.radius,l.y-l.radius,l.radius*2,l.radius*2),N.returnInstance(l)}s.globalCompositeOperation="lighten",s.lineWidth=k.drawWidth,s.lineCap=re?"square":"round",i.strokeStyle="#fff",i.lineWidth=1,i.beginPath(),W.forEach(l=>{let r=k.active[l];s.strokeStyle=l,s.beginPath(),r.forEach(u=>{u.visible&&(s.moveTo(u.x,u.y),s.lineTo(u.prevX,u.prevY),i.moveTo(u.x,u.y),i.lineTo(u.x-u.speedX*1.6,u.y-u.speedY*1.6))}),s.stroke()}),i.stroke(),s.lineWidth=P.drawWidth,s.lineCap="butt",W.forEach(l=>{let r=P.active[l];s.strokeStyle=l,s.beginPath(),r.forEach(u=>{s.moveTo(u.x,u.y),s.lineTo(u.prevX,u.prevY)}),s.stroke()}),Y&&(i.globalAlpha=Y,i.fillStyle=p.Blue,i.fillRect(0,o-6,n*K,6),i.globalAlpha=1),s.setTransform(1,0,0,1,0,0),i.setTransform(1,0,0,1,0,0)}var R={r:0,g:0,b:0},L={r:0,g:0,b:0};function Qt(e){let t=ke()*15,n=500,o=0;L.r=0,L.g=0,L.b=0,W.forEach(l=>{let r=Je[l],u=k.active[l].length;o+=u,L.r+=r.r*u,L.g+=r.g*u,L.b+=r.b*u});let s=Math.pow(Math.min(1,o/n),.3),i=Math.max(1,L.r,L.g,L.b);L.r=L.r/i*t*s,L.g=L.g/i*t*s,L.b=L.b/i*t*s;let c=10;R.r+=(L.r-R.r)/c*e,R.g+=(L.g-R.g)/c*e,R.b+=(L.b-R.b)/c*e,h.canvasContainer.style.backgroundColor=`rgb(${R.r|0}, ${R.g|0}, ${R.b|0})`}C.addEventListener("ticker",Ut);function Te(e,t,n,o,s){let i=t/n,c=e+t-i*.5;if(c>e)for(let l=e;l<c;l=l+i)s(l+Math.random()*i*o);else for(let l=e;l>c;l=l+i)s(l+Math.random()*i*o)}function O(e,t,n=0,o=q){let i=2*(.5*Math.sqrt(e/Math.PI))*Math.PI,c=i/2;for(let l=0;l<=c;l++){let r=l/c*Me,u=Math.cos(r),m=i*u,v=m*(o/q),S=q/m,d=Math.random()*S+n,a=S*.33;for(let b=0;b<v;b++){let y=Math.random()*a,ee=S*b+d+y;t(ee,u)}}}function Jt(e){let t=Math.random()*Me;Te(t,q,4,.5,n=>{k.add(e.x,e.y,e.color,n,Math.random()*.6+.75,600)})}function Zt(e){let t=12+6*I;O(t,(n,o)=>{k.add(e.x,e.y,e.color,n,o*2.4,1e3+Math.random()*300,e.speedX,e.speedY)}),N.add(e.x,e.y,46),z.playSound("burstSmall")}function en(e){O(7,(t,n)=>{let o=k.add(e.x,e.y,D,t,n*2.4,2400+Math.random()*600,e.speedX,e.speedY);o.sparkColor=p.Gold,o.sparkFreq=144/I,o.sparkSpeed=.28,o.sparkLife=750,o.sparkLifeVariation=3.2}),N.add(e.x,e.y,46),z.playSound("burstSmall")}function tn(e){Te(0,q,Q?32:16,1.8,n=>{P.add(e.x,e.y,p.Gold,n,Math.pow(Math.random(),.45)*2.4,300+Math.random()*200)})}var E=class e{constructor(t){if(Object.assign(this,t),this.starLifeVariation=t.starLifeVariation||.125,this.color=t.color||M(),this.glitterColor=t.glitterColor||this.color,!this.starCount){let n=t.starDensity||1,o=this.spreadSize/54;this.starCount=Math.max(6,o*o*n)}}launch(t,n){let o=ae,s=ie,i=60,c=50,r=s-s*.45,u=t*(o-i*2)+i,m=s,v=r-n*(r-c),S=m-v,d=Math.pow(S*.04,.64),a=this.comet=k.add(u,m,typeof this.color=="string"&&this.color!=="random"?this.color:p.White,Math.PI,d*(this.horsetail?1.2:1),d*(this.horsetail?100:400));a.heavy=!0,a.spinRadius=g.random(.32,.85),a.sparkFreq=32/I,Q&&(a.sparkFreq=8),a.sparkLife=320,a.sparkLifeVariation=3,(this.glitter==="willow"||this.fallingLeaves)&&(a.sparkFreq=20/I,a.sparkSpeed=.5,a.sparkLife=500),this.color===D&&(a.sparkColor=p.Gold),Math.random()>.4&&!this.horsetail&&(a.secondColor=D,a.transitionTime=Math.pow(Math.random(),1.5)*700+500),a.onDeath=b=>this.burst(b.x,b.y),z.playSound("lift")}burst(t,n){let o=this.spreadSize/96,s,i,c,l,r,u=.25,m=!1;this.crossette&&(i=d=>{m||(z.playSound("crackleSmall"),m=!0),Jt(d)}),this.crackle&&(i=d=>{m||(z.playSound("crackle"),m=!0),tn(d)}),this.floral&&(i=Zt),this.fallingLeaves&&(i=en),this.glitter==="light"?(c=400,l=.3,r=300,u=2):this.glitter==="medium"?(c=200,l=.44,r=700,u=2):this.glitter==="heavy"?(c=80,l=.8,r=1400,u=2):this.glitter==="thick"?(c=16,l=Q?1.65:1.5,r=1400,u=3):this.glitter==="streamer"?(c=32,l=1.05,r=620,u=2):this.glitter==="willow"&&(c=120,l=.34,r=1400,u=3.8),c=c/I;let v=!0,S=(d,a)=>{let b=this.spreadSize/1800,y=k.add(t,n,s||M(),d,a*o,this.starLife+Math.random()*this.starLife*this.starLifeVariation,this.horsetail?this.comet&&this.comet.speedX:0,this.horsetail?this.comet&&this.comet.speedY:-b);this.secondColor&&(y.transitionTime=this.starLife*(Math.random()*.05+.32),y.secondColor=this.secondColor),this.strobe&&(y.transitionTime=this.starLife*(Math.random()*.08+.46),y.strobe=!0,y.strobeFreq=Math.random()*20+40,this.strobeColor&&(y.secondColor=this.strobeColor)),y.onDeath=i,this.glitter&&(y.sparkFreq=c,y.sparkSpeed=l,y.sparkLife=r,y.sparkLifeVariation=u,y.sparkColor=this.glitterColor,y.sparkTimer=Math.random()*y.sparkFreq)};if(typeof this.color=="string")if(this.color==="random"?s=null:s=this.color,this.ring){let d=Math.random()*Math.PI,a=Math.pow(Math.random(),2)*.85+.15;Te(0,q,this.starCount,0,b=>{let y=Math.sin(b)*o*a,ee=Math.cos(b)*o,at=g.pointDist(0,0,y,ee),it=g.pointAngle(0,0,y,ee)+d,H=k.add(t,n,s,it,at,this.starLife+Math.random()*this.starLife*this.starLifeVariation);this.glitter&&(H.sparkFreq=c,H.sparkSpeed=l,H.sparkLife=r,H.sparkLifeVariation=u,H.sparkColor=this.glitterColor,H.sparkTimer=Math.random()*H.sparkFreq)})}else O(this.starCount,S);else if(Array.isArray(this.color))if(Math.random()<.5){let d=Math.random()*Math.PI,a=d+Math.PI,b=Math.PI;s=this.color[0],O(this.starCount,S,d,b),s=this.color[1],O(this.starCount,S,a,b)}else s=this.color[0],O(this.starCount/2,S),s=this.color[1],O(this.starCount/2,S);else throw new Error("Invalid shell color. Expected string or array of strings, but got: "+this.color);if(this.pistil&&new e({spreadSize:this.spreadSize*.5,starLife:this.starLife*.6,starLifeVariation:this.starLifeVariation,starDensity:1.4,color:this.pistilColor,glitter:"light",glitterColor:this.pistilColor===p.Gold?p.Gold:p.White}).burst(t,n),this.streamers&&new e({spreadSize:this.spreadSize*.9,starLife:this.starLife*.8,starLifeVariation:this.starLifeVariation,starCount:Math.floor(Math.max(6,this.spreadSize/45)),color:p.White,glitter:"streamer"}).burst(t,n),N.add(t,n,this.spreadSize/4),this.comet){let b=(1-Math.min(2,V()-this.shellSize)/2)*.3+.7;z.playSound("burst",b)}}},N={active:[],_pool:[],_new(){return{}},add(e,t,n){let o=this._pool.pop()||this._new();return o.x=e,o.y=t,o.radius=n,this.active.push(o),o},returnInstance(e){this._pool.push(e)}};function st(){let e={};return Ce.forEach(t=>{e[t]=[]}),e}var k={drawWidth:3,airDrag:.98,airDragHeavy:.992,active:st(),_pool:[],_new(){return{}},add(e,t,n,o,s,i,c,l){let r=this._pool.pop()||this._new();return r.visible=!0,r.heavy=!1,r.x=e,r.y=t,r.prevX=e,r.prevY=t,r.color=n,r.speedX=Math.sin(o)*s+(c||0),r.speedY=Math.cos(o)*s+(l||0),r.life=i,r.fullLife=i,r.spinAngle=Math.random()*q,r.spinSpeed=.8,r.spinRadius=0,r.sparkFreq=0,r.sparkSpeed=1,r.sparkTimer=0,r.sparkColor=n,r.sparkLife=750,r.sparkLifeVariation=.25,r.strobe=!1,this.active[n].push(r),r},returnInstance(e){e.onDeath&&e.onDeath(e),e.onDeath=null,e.secondColor=null,e.transitionTime=0,e.colorChanged=!1,this._pool.push(e)}},P={drawWidth:0,airDrag:.9,active:st(),_pool:[],_new(){return{}},add(e,t,n,o,s,i){let c=this._pool.pop()||this._new();return c.x=e,c.y=t,c.prevX=e,c.prevY=t,c.color=n,c.speedX=Math.sin(o)*s,c.speedY=Math.cos(o)*s,c.life=i,this.active[n].push(c),c},returnInstance(e){this._pool.push(e)}},z={baseURL:"https://s3-us-west-2.amazonaws.com/s.cdpn.io/329180/",ctx:new(window.AudioContext||window.webkitAudioContext),sources:{lift:{volume:1,playbackRateMin:.85,playbackRateMax:.95,fileNames:["lift1.mp3","lift2.mp3","lift3.mp3"]},burst:{volume:1,playbackRateMin:.8,playbackRateMax:.9,fileNames:["burst1.mp3","burst2.mp3"]},burstSmall:{volume:.25,playbackRateMin:.8,playbackRateMax:1,fileNames:["burst-sm-1.mp3","burst-sm-2.mp3"]},crackle:{volume:.2,playbackRateMin:1,playbackRateMax:1,fileNames:["crackle1.mp3"]},crackleSmall:{volume:.3,playbackRateMin:1,playbackRateMax:1,fileNames:["crackle-sm-1.mp3"]}},preload(){let e=[];function t(o){if(o.status>=200&&o.status<300)return o;let s=new Error(o.statusText);throw s.response=o,s}return Object.keys(this.sources).forEach(o=>{let s=this.sources[o],{fileNames:i}=s,c=[];i.forEach(l=>{let r=this.baseURL+l,u=fetch(r).then(t).then(m=>m.arrayBuffer()).then(m=>new Promise(v=>{this.ctx.decodeAudioData(m,v)}));c.push(u),e.push(u)}),Promise.all(c).then(l=>{s.buffers=l})}),Promise.all(e)},pauseAll(){this.ctx.suspend()},resumeAll(){this.playSound("lift",0),setTimeout(()=>{this.ctx.resume()},250)},_lastSmallBurstTime:0,playSound(e,t=1){if(t=g.clamp(t,0,1),!me()||K<.95)return;if(e==="burstSmall"){let m=Date.now();if(m-this._lastSmallBurstTime<20)return;this._lastSmallBurstTime=m}let n=this.sources[e];if(!n)throw new Error(`Sound of type "${e}" doesn't exist.`);let o=n.volume,s=g.random(n.playbackRateMin,n.playbackRateMax),i=o*t,c=s*(2-t),l=this.ctx.createGain();l.gain.value=i;let r=g.randomChoice(n.buffers),u=this.ctx.createBufferSource();u.playbackRate.value=c,u.buffer=r,u.connect(l),l.connect(this.ctx.destination),u.start(0)}};function nn(e){document.querySelector(".loading-init__status").textContent=e}_?ue():(nn("Lighting Fuses"),setTimeout(()=>{z.preload().then(ue,e=>(ue(),Promise.reject(e)))},0));})();
  </script>
</body></html>